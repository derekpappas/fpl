// Author: cghaba
// Date: April 2, 2008

/*
    +--------------------------------------------------------+
    | +---------+---------------+---------------------+      +
    | |   +-----+----+                          +-----+----+ |
    | |   |  +--+-+  |                          |  +--+-+  | |
    | |   |  |    |  |                          |  |    |  | |
  --+-+---+--+    +--+--     +-------+          |  +    +--+-+----
    | |   |  |    |  |  \----+       +-        /+--|    |  | |
    | |   |  +----+  |       |       | \-/----- |  +----+  | |
    | |   |          |       |       +---\-     |          | |
    | |   |          |     /-+       |     \-   |          | |
    | |   |  +----+  /-----  +-------+       \- |  +----+  | |
    | |   |  |    +--|                         \+  |    |  | |
  --+-+---+--+    |  |                          |\-+    +--+-+----
    | |   |  |    |  |                          |  \    |  | |
    | |   |  +--+-+  |                          |  +--+-+  | |
    | |   +-----+----+                          +-----+----+ |
 ---+-+---------+--------------+----------------------+      |
    +--------------------------------------------------------+

*/
// data and selection widths
/*csl_enum e_widths{
  D_WIDTH=8,
  S_WIDTH=2
    };*/

// bitranges
csl_bitrange br_d(8);
csl_bitrange br_s(2);

// interfaces
csl_interface ifca{
  csl_port pinx(input,br_d);
  csl_port piny(input,br_d);
  ifca(){
  }
};

csl_signal_group sga{
  csl_signal pinx(br_d);
  csl_signal piny(br_d);
  sga(){
  }
};

csl_interface ifcresclk{
  csl_port reset(input);
  csl_port clock(input);
  ifcresclk(){
  }
};

// units
csl_unit uu{

  csl_port sel(input,br_s);
  ifcresclk irc;  
  ifca iin0;   
  ifca iin1;
  ifca iout;
  uu(){
    iout.reverse();
  }
};       
         

csl_unit uv{
  ifcresclk irc;
  ifca iin1;
  ifca iin2;
  ifca iout1;
  ifca iout2;
  uv(){
    iout1.reverse();
    iout2.reverse();
  }
};


csl_unit uxy{
  ifcresclk irc0;  
  ifca iin;
  sga sg1;
  csl_port psel1(input,br_s),psel2(input,br_s);
  uu ux(.irc(irc0),.sel(psel1),.iin1(sg1));
  uu uy(.irc(irc0),.sel(psel2),.iin1(sg1));
  uxy(){
  }
};

// top unit
csl_unit top{
  ifcresclk irc1;  
  // top ports
  csl_port tsel(input,2);
  //top interfaces
  ifca ifcxin;
  ifca ifcyin;
  ifca ifcxout;
  ifca ifcyout; 
  sga sg0,sg1;
  // unit instances
  uxy uxy0(.irc0(irc1),.iin(ifcxin));
  uxy uxy1(.irc0(irc1),.iin(ifcyin));
  uv uv0(.irc(irc1),.iin2(ifcxin));
  top(){
    ifcxout.reverse();
    ifcyout.reverse();

    //connections from left to right
    ifcxin.connect_by_name(uxy0.ux.iin0);
    ifcxin.connect_by_name(uxy1.uy.iin0);
    uxy0.ux.iout.connect_by_name(uv0.iin1);
    uxy0.uy.iout.connect_by_name(uv0.iin2);
    uv0.iout1.connect_by_name(sg0);
    uv0.iout2.connect_by_name(sg1);
    uxy1.ux.iout.connect_by_name(ifcxout);
    uxy1.uy.iout.connect_by_name(ifcyout);
    tsel.connect_by_pattern(sel); 
    ifcyout.pinx = sg1.pinx;
    ifcyout.piny = sg1.piny;
  }
};
  
