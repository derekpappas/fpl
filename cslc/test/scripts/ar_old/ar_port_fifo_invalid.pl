#!/usr/bin/perl

#Author Monica
use strict;

if(! defined $ENV{WORK}){
    die "[ERROR] The environment variable WORK is not set. Set it to point to TOT/se";
}

my $totDir     = $ENV{WORK};
&testDirExists($totDir);

sub testDirExists {
    my($execName) = @_;
    unless(-e "$execName") { die "[ERROR] The directory $execName does not exist!\n"; }
    
}

sub mkDir {
    my($dirName) = @_;
    unless(-e "$dirName")  { `mkdir $dirName`; }
}

foreach(my $i = 1; $i <= 40; $i++) {
    &main($i);
}

sub main {
    my $i = $_[0];
    my $test_name = "connect_port_fifo_test".$i."_illegal.csl";
    &createCslFile($test_name, $i);
}
sub createCslFile {
    my($test_name, $i) = @_;
    my $path = "$ENV{WORK}/test/csl_ar_gen/";
 if($i==1){
        print ("Generated path: $path/ar_connect_port_fifo_invalid/ \n");}
    my $val = int(rand(500));
    if($val == 0) { $val = 1; }
    my $val1 =int(rand(25))+1;

    if($test_name=~/(_illegal)/){
        &mkDir("$path/ar_connect_port_fifo_invalid");
        open(FH,">$path/ar_connect_port_fifo_invalid/$test_name");
    }
#*************************************************
#port.connect(fifo)

    if( $i<=10){
    print FH "//Generated by Monica\n";
    print FH "//Connect port--fifo\n\n";
    print FH "// INVALID TEST $i;\n";

     print FH "csl_bitrange br1($val);\n";
     print FH "csl_bitrange br2($val1);\n\n";
  
    print FH " csl_enum e_width{\n";
    print FH "  data_w =$val,\n";
    print FH "  addr_w =$val1\n";
    print FH " };\n";
   
    print FH " csl_fifo f_$i {\n";
    print FH " f_$i(){\n";
    print FH " set_width(data_w);\n";
    print FH " set_depth(1<<addr_w);\n";
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit u_$i {\n";
    foreach( my $j=1; $j<=$i+1; $j++){
    print FH "   csl_port  p1_$j(input,$j);\n";
    print FH "   csl_port  p2_$j(output,$j);\n";
}
foreach( my $j=1; $j<=$i+1; $j++){
    print FH " f_$i f1_i$j;\n";
}
    print FH " u_$i(){\n";
foreach( my $j=1; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " p1_$j.connect(f1_i$j);              //invalid connection: port--fifo\n";
    print FH " p2_$j.connect(f1_i$k);              //invalid connection: port--fifo\n";
    print FH " p1_$j.connect(f1_i$k);              //invalid connection: port--fifo\n";
    print FH " p2_$j.connect(f1_i$j);              //invalid connection: port--fifo\n";
  #  print FH " f1_i$j.wr_data.connect(f1_i$k);     //invalid connection: rf.port--rf\n";
}
}
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit top_$i {\n";
     foreach( my $j=1; $j<=$i+1; $j++){
    print FH "   csl_port  pt1_$j(input,$j);\n";
    print FH "   csl_port  pt2_$j(output,$j);\n";
}
foreach( my $j=1; $j<=$i+1; $j++){
    print FH " f_$i f2_i$j;\n";
}
foreach( my $j=1; $j<=$i+1; $j++){
    print FH " u_$i u_i$j;\n";
}
 print FH " top_$i(){\n";
foreach( my $j=1; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " pt1_$j.connect(f2_i$j);              //invalid connection: port--fifo\n";
    print FH " pt2_$j.connect(f2_i$j);              //invalid connection: port--fifo\n";
 #   print FH " f2_i$j.wr_data.connect(f2_i$k);     //invalid connection: fifo.port--fifo\n";
    print FH " u_i$j.p1_$j.connect(f2_i$j);         //invalid connection: unit.port--fifo\n";
    print FH " u_i$j.p2_$j.connect(u_i$k.f1_i$k);  //invalid connection: unit.port--unit.fifo\n";
    print FH " pt1_$j.connect(u_i$j.f1_i$j);       //invalid connection: port--unit.fifo\n";
}
}
    print FH " }\n";
    print FH "};\n";
}
#*************************************************
#signal.connect(fifo)

    if( $i>10 && $i<=20){
    print FH "//Generated by Monica\n";
    print FH "//Connect signal--fifo\n\n";
    print FH "// INVALID TEST $i;\n";
     print FH "csl_bitrange br1($val);\n";
     print FH "csl_bitrange br2($val1);\n\n";  

    print FH " csl_enum e_width{\n";
    print FH "  data_w =$val,\n";
    print FH "  addr_w =$val1\n";
    print FH " };\n";
   
    print FH " csl_fifo f_$i {\n";
    print FH " f_$i(){\n";
    print FH " set_width(data_w);\n";
    print FH " set_depth(1<<addr_w);\n";
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit u_$i {\n";
    foreach( my $j=11; $j<=$i+1; $j++){
    print FH "   csl_signal  s1_$j($j);\n";
    print FH "   csl_signal  s2_$j($j);\n";
}
foreach( my $j=11; $j<=$i+1; $j++){
    print FH " f_$i f1_i$j;\n";
}
    print FH " u_$i(){\n";
foreach( my $j=11; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " s1_$j.connect(f1_i$j);              //invalid connection: signal--fifo\n";
    print FH " s2_$j.connect(f1_i$j);              //invalid connection: signal--fifo\n";
    print FH " s1_$j.connect(f1_i$k);              //invalid connection: signal--fifo\n";
    print FH " s2_$j.connect(f1_i$k);              //invalid connection: signal--fifo\n";
}
}
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit top_$i {\n";
     foreach( my $j=11; $j<=$i+1; $j++){
    print FH "   csl_signal  st1_$j($j);\n";
    print FH "   csl_signal  st2_$j($j);\n";
}
foreach( my $j=11; $j<=$i+1; $j++){
    print FH " f_$i f2_i$j;\n";
}
foreach( my $j=11; $j<=$i+1; $j++){
    print FH " u_$i u_i$j;\n";
}
 print FH " top_$i(){\n";
foreach( my $j=11; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " st1_$j.connect(f2_i$j);              //invalid connection: signal--fifo\n";
    print FH " st2_$j.connect(f2_i$j);              //invalid connection: signal--fifo\n";
    print FH " u_i$j.s1_$j.connect(f2_i$j);         //invalid connection: unit.signal--fifo\n";
    print FH " u_i$j.s2_$j.connect(u_i$k.f1_i$j);  //invalid connection: unit.signal--unit.fifo\n";
    print FH " st1_$j.connect(u_i$j.f1_i$j);       //invalid connection: signal--unit.fifo\n";
}
}
    print FH " }\n";
    print FH "};\n";
}
#*************************************************
#unit.connect(fifo)
  
    if( $i>20 && $i<=30){
    print FH "//Generated by Monica\n";
    print FH "//Connect unit--fifo\n\n";
    print FH "// INVALID TEST $i;\n";

     print FH "csl_bitrange br1($val);\n";
     print FH "csl_bitrange br2($val1);\n\n";  

    print FH " csl_enum e_width{\n";
    print FH "  data_w =$val,\n";
    print FH "  addr_w =$val1\n";
    print FH " };\n";
   
    print FH " csl_fifo f_$i {\n";
    print FH " f_$i(){\n";
    print FH " set_width(data_w);\n";
    print FH " set_depth(1<<addr_w);\n";
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit u_$i {\n";
    foreach( my $j=21; $j<=$i+1; $j++){
    print FH "   csl_port  p1_$j(input,$j);\n";
    print FH "   csl_port  p2_$j(output,$j);\n";
}
foreach( my $j=21; $j<=$i+1; $j++){
    print FH " f_$i f1_i$j;\n";
}
    print FH " u_$i(){\n";

    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit top_$i {\n";
     foreach( my $j=21; $j<=$i+1; $j++){
    print FH "   csl_port  pt1_$j(input,$j);\n";
    print FH "   csl_port  pt2_$j(output,$j);\n";
}
foreach( my $j=21; $j<=$i+1; $j++){
    print FH " f_$i f2_i$j;\n";
}
foreach( my $j=21; $j<=$i+1; $j++){
    print FH " u_$i u_i$j;\n";
}
 print FH " top_$i(){\n";
foreach( my $j=21; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " u_i$j.connect(f2_i$j);               //invalid connection: unit--fifo\n";
    print FH " u_i$j.connect(u_i$k.f1_i$j);         //invalid connection: unit--unit.fifo\n";
    print FH " u_i$j.connect(f2_i$k);                //invalid connection: unit--fifo\n";
    print FH " u_i$j.connect(u_i$k.f1_i$k);          //invalid connection: unit--fifo\n"; 
}
}
    print FH " }\n";
    print FH "};\n";
}
#*************************************************
# rf.connect(fifo)
 
    if( $i>30 && $i<=40){
    print FH "//Generated by Monica\n";
    print FH "//Connect rf--fifo\n\n";
    print FH "// INVALID TEST $i;\n";

     print FH "csl_bitrange br1($val);\n";
     print FH "csl_bitrange br2($val1);\n\n";  

    print FH " csl_enum e_width{\n";
    print FH "  data_w =$val,\n";
    print FH "  addr_w =$val1\n";
    print FH " };\n";
   
    print FH " csl_register_file rf_$i {\n";
    print FH " rf_$i(){\n";
    print FH " set_width(data_w);\n";
    print FH " set_depth(1<<addr_w);\n";
    print FH " }\n";
    print FH "};\n";

    print FH " csl_fifo f_$i {\n";
    print FH " f_$i(){\n";
    print FH " set_width(data_w);\n";
    print FH " set_depth(1<<addr_w);\n";
    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit u_$i {\n";
    foreach( my $j=31; $j<=$i+1; $j++){
    print FH "   csl_port  p1_$j(input,$j);\n";
    print FH "   csl_port  p2_$j(output,$j);\n";
}
foreach( my $j=31; $j<=$i+1; $j++){
    print FH " rf_$i rf1_i$j;\n";
}
foreach( my $j=31; $j<=$i+1; $j++){
    print FH " f_$i f1_i$j;\n";
}
    print FH " u_$i(){\n";

    print FH " }\n";
    print FH "};\n";

    print FH " csl_unit top_$i {\n";
     foreach( my $j=31; $j<=$i+1; $j++){
    print FH "   csl_port  pt1_$j(input,$j);\n";
    print FH "   csl_port  pt2_$j(output,$j);\n";
}
foreach( my $j=31; $j<=$i+1; $j++){
    print FH " rf_$i rf2_i$j;\n";
}
foreach( my $j=31; $j<=$i+1; $j++){
    print FH " f_$i f2_i$j;\n";
}
foreach( my $j=31; $j<=$i+1; $j++){
    print FH " u_$i u_i$j;\n";
}
 print FH " top_$i(){\n";
foreach( my $j=31; $j<=$i+1; $j++){
    my $k=$j+1;
    if($k<=$i+1){
    print FH " u_i$j.rf1_i$k.connect(f2_i$j);               //invalid connection: unit.rf--fifo\n";
    print FH " u_i$j.rf1_i$j.connect(u_i$k.f1_i$k);         //invalid connection: unit.rf--unit.fifo\n";
    print FH " rf2_i$j.connect(f2_i$k);                     //invalid connection: rf--fifo\n";
    print FH " rf2_i$j.connect(u_i$j.f1_i$j);               //invalid connection: rf--unit.fifo\n";
}
}
    print FH " }\n";
    print FH "};\n";
}
    close(FH);
}
